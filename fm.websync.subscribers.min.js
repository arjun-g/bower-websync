
/*
 * Title: WebSync Client Subscribers Extension for JavaScript
 * Version: 4.9.1
 * Copyright Frozen Mountain Software 2011+
 */

!function(e,t,n){if("function"==typeof define&&define.amd)define(e,t,n);else if("object"==typeof exports){for(var s=0;s<t.length;s++)require("./"+t[s]);module.exports=n()}else this[e]=n()}("fm.websync.subscribers",["fm.websync","fm"],function(){if("undefined"==typeof global||global.window||(global.window=global,global.document={cookie:""}),!window.fm)throw new Error("fm must be loaded before fm.websync.subscribers.");if(!window.fm.websync)throw new Error("fm.websync must be loaded before fm.websync.subscribers.");window.fm.websync.subscribers||(window.fm.websync.subscribers={}),fm.websync.subscribers.getVersion=function(){return"4.9.1"},fm.websync.subscribers.subscriberChangeType={Subscribe:1,Unsubscribe:2};var e=function(e,n){function s(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return s.prototype=n.prototype,e.prototype=new s,e.__super__=n.prototype,e},t={}.hasOwnProperty;fm.websync.subscribers.base=function(t){function n(){var e;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(e=n.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),e):void 0}return e(n,t),n._subscribersChannelPrefix="/fm/subscribers",n._subscribersExtensionName="fm.subscribers",n.getSubscribedClients=function(){var e,t;if(t=arguments[0],e=fm.websync.subscribers.serializer.deserializeSubscribedClients(t.getExtensionValueJson("fm.subscribers")),fm.global.equals(e,null))throw new Error("Subscribed clients could not be parsed.");return e},n.setSubscribedClients=function(){var e,t;return e=arguments[0],t=arguments[1],e.setExtensionValueJson("fm.subscribers",fm.websync.subscribers.serializer.serializeSubscribedClients(t))},n}(fm.object);var n=function(e,t){return function(){return e.apply(t,arguments)}},e=function(e,n){function s(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return s.prototype=n.prototype,e.prototype=new s,e.__super__=n.prototype,e},t={}.hasOwnProperty;fm.websync.subscribers.clientUnsubscribeArgs=function(t){function s(){this.getUnsubscribedClient=n(this.getUnsubscribedClient,this),this.getChannel=n(this.getChannel,this);var e,t,r;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(t=s.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),t):(e=arguments[0],r=arguments[1],t=s.__super__.constructor.call(this),this.__channel=e,this.__unsubscribedClient=r,t)}return e(s,t),s.prototype.__channel=null,s.prototype.__unsubscribedClient=null,s.prototype.getChannel=function(){return this.__channel},s.prototype.getUnsubscribedClient=function(){return this.__unsubscribedClient},s}(fm.websync.baseSuccessArgs);var e=function(e,n){function s(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return s.prototype=n.prototype,e.prototype=new s,e.__super__=n.prototype,e},t={}.hasOwnProperty;fm.websync.subscribers.serializer=function(t){function n(){var e;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(e=n.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),e):e=n.__super__.constructor.call(this)}return e(n,t),n.createSubscribedClients=function(){return{}},n.createSubscriberChange=function(){return new fm.websync.subscribers.subscriberChange},n.deserializeSubscribedClients=function(){var e;return e=arguments[0],fm.serializer.deserializeObject(e,n.createSubscribedClients,n.deserializeSubscribedClientsCallback)},n.deserializeSubscribedClientsCallback=function(){var e,t,n;return t=arguments[0],e=arguments[1],n=arguments[2],t[e]=fm.websync.subscribedClient.fromJsonMultiple(n)},n.deserializeSubscriberChange=function(){var e;return e=arguments[0],fm.serializer.deserializeObjectFast(e,n.createSubscriberChange,n.deserializeSubscriberChangeCallback)},n.deserializeSubscriberChangeCallback=function(){var e,t,n,s;if(n=arguments[0],e=arguments[1],s=arguments[2],t=e,!fm.global.equals(t,null)){if(fm.global.equals(t,"client"))return n.setClient(fm.websync.subscribedClient.fromJson(s));if(fm.global.equals(t,"type"))return n.setType(fm.websync.subscribers.serializer.deserializeSubscriberChangeType(s))}},n.deserializeSubscriberChangeType=function(){var e;switch(e=arguments[0],fm.serializer.deserializeString(e)){case"subscribe":return fm.websync.subscribers.subscriberChangeType.Subscribe;case"unsubscribe":return fm.websync.subscribers.subscriberChangeType.Unsubscribe}throw new Error("Unknown subscriber change type.")},n.serializeSubscribedClients=function(){var e;return e=arguments[0],fm.serializer.serializeObject(e,n.serializeSubscribedClientsCallback)},n.serializeSubscribedClientsCallback=function(){var e,t,n,s,r,i,o;for(o=arguments[0],n=arguments[1],e=fm.hashExtensions.getKeys(o),r=[],t=0,s=e.length;s>t;t++)i=e[t],r.push(n[i]=fm.websync.subscribedClient.toJsonMultiple(o[i]));return r},n.serializeSubscriberChange=function(){var e;return e=arguments[0],fm.serializer.serializeObjectFast(e,n.serializeSubscriberChangeCallback)},n.serializeSubscriberChangeCallback=function(){var e,t;return t=arguments[0],e=arguments[1],fm.global.equals(t.getClient(),null)||(e.client=fm.websync.subscribedClient.toJson(t.getClient())),e.type=fm.websync.subscribers.serializer.serializeSubscriberChangeType(t.getType())},n.serializeSubscriberChangeType=function(){var e,t;switch(t=arguments[0]){case fm.websync.subscribers.subscriberChangeType.Subscribe:e="subscribe";break;case fm.websync.subscribers.subscriberChangeType.Unsubscribe:e="unsubscribe";break;default:throw new Error("Unknown subscriber change type.")}return fm.serializer.serializeString(e)},n}(fm.object),fm.websync.subscribers.subscribeArgsExtensions=function(){function e(){var t;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(t=e.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),t):void 0}return e._onClientSubscribePropertyName=null,e._onClientUnsubscribePropertyName=null,e.client_OnReceive=function(){var e,t,n,s,r,i,o,a,u,l,c,h,p,g;if(a=arguments[0],i=fm.websync.subscribers.serializer.deserializeSubscriberChange(a.getDataJson()),!fm.guid.equals(i.getClient().getClientId(),a.getClient().getClientId()))if(o=fm.global.tryCastObject(a.getClient().getDynamicValue(fm.websync.subscribers.subscribeArgsExtensions.getDynamicPropertiesKey(a.getChannel()))),fm.global.equals(i.getType(),fm.websync.subscribers.subscriberChangeType.Subscribe)){if(e=fm.global.tryCast(a.getClient().getDynamicValue(fm.websync.subscribers.subscribeArgsExtensions.getOnClientSubscribeKey(a.getChannel())),Function),!fm.global.equals(e,null)){n=new fm.websync.subscribers.clientSubscribeArgs(a.getChannel().substring("/fm/subscribers".length),i.getClient()),n.setTimestamp(a.getTimestamp()),n.setClient(a.getClient()),n.setDynamicProperties(o),g=n,g.copyExtensions(a);try{return e(g)}catch(u){if(h=u,c=h,!a.getClient().raiseUnhandledException(c))return fm.asyncException.asyncThrow(c,"Client -> Subscribe -> OnClientSubscribe")}finally{}}}else if(t=fm.global.tryCast(a.getClient().getDynamicValue(fm.websync.subscribers.subscribeArgsExtensions.getOnClientUnsubscribeKey(a.getChannel())),Function),!fm.global.equals(t,null)){r=new fm.websync.subscribers.clientUnsubscribeArgs(a.getChannel().substring("/fm/subscribers".length),i.getClient()),r.setTimestamp(a.getTimestamp()),r.setClient(a.getClient()),r.setDynamicProperties(o),s=r,s.copyExtensions(a);try{return t(s)}catch(l){if(p=l,c=p,!a.getClient().raiseUnhandledException(c))return fm.asyncException.asyncThrow(c,"Client -> Subscribe -> OnClientUnsubscribe")}finally{}}},e.client_OnSubscribeEnd=function(){var t,n,s,r,i,o,a,u,l,c;if(s=arguments[0],n=arguments[1],fm.global.equals(n.getException(),null)&&(o=fm.websync.subscribers.subscribeArgsExtensions.getOnClientSubscribe(n.getMethodArgs()),a=fm.websync.subscribers.subscribeArgsExtensions.getOnClientUnsubscribe(n.getMethodArgs()),!fm.global.equals(o,null)||!fm.global.equals(a,null))){for(t=n.getResponse().getChannels(),u=[],r=0,i=t.length;i>r;r++)l=t[r],c=fm.stringExtensions.concat("/fm/subscribers",l),s.setDynamicValue(fm.websync.subscribers.subscribeArgsExtensions.getOnClientSubscribeKey(c),o),s.setDynamicValue(fm.websync.subscribers.subscribeArgsExtensions.getOnClientUnsubscribeKey(c),a),s.setDynamicValue(fm.websync.subscribers.subscribeArgsExtensions.getDynamicPropertiesKey(c),n.getMethodArgs().getDynamicProperties()),u.push(n.getClient().setCustomOnReceive(c,e.client_OnReceive));return u}},e.client_OnSubscribeRequest=function(){var e,t,n,s,r,i,o,a,u;if(n=arguments[0],t=arguments[1],o=fm.websync.subscribers.subscribeArgsExtensions.getOnClientSubscribe(t.getMethodArgs()),a=fm.websync.subscribers.subscribeArgsExtensions.getOnClientUnsubscribe(t.getMethodArgs()),!fm.global.equals(o,null)||!fm.global.equals(a,null)){for(i=[],e=t.getMethodArgs().getChannels(),s=0,r=e.length;r>s;s++)u=e[s],fm.arrayExtensions.add(i,u),fm.arrayExtensions.add(i,fm.stringExtensions.concat("/fm/subscribers",u));return t.getMethodArgs().setChannels(fm.arrayExtensions.toArray(i))}},e.client_OnSubscribeResponse=function(){var e,t,n,s,r,i,o;if(n=arguments[0],t=arguments[1],fm.global.equals(t.getException(),null)){for(i=[],e=t.getResponse().getChannels(),s=0,r=e.length;r>s;s++)o=e[s],fm.stringExtensions.startsWith(o,"/fm/subscribers/")||fm.arrayExtensions.add(i,o);return t.getMethodArgs().setChannels(fm.arrayExtensions.toArray(i)),t.getResponse().setChannels(fm.arrayExtensions.toArray(i))}},e.client_OnUnsubscribeRequest=function(){var e,t,n,s,r,i,o;for(t=arguments[0],n=arguments[1],i=[],e=n.getMethodArgs().getChannels(),s=0,r=e.length;r>s;s++)o=e[s],fm.arrayExtensions.add(i,o),fm.arrayExtensions.add(i,fm.stringExtensions.concat("/fm/subscribers",o));return n.getMethodArgs().setChannels(fm.arrayExtensions.toArray(i))},e.client_OnUnsubscribeResponse=function(){var e,t,n,s,r,i,o,a,u,l;if(n=arguments[0],s=arguments[1],fm.global.equals(s.getException(),null)){for(e=s.getResponse().getChannels(),r=0,o=e.length;o>r;r++)l=e[r],fm.stringExtensions.startsWith(l,"/fm/subscribers")&&(s.getClient().unsetCustomOnReceive(l),s.getClient().unsetDynamicValue(fm.websync.subscribers.subscribeArgsExtensions.getOnClientSubscribeKey(l)),s.getClient().unsetDynamicValue(fm.websync.subscribers.subscribeArgsExtensions.getOnClientUnsubscribeKey(l)),s.getClient().unsetDynamicValue(fm.websync.subscribers.subscribeArgsExtensions.getDynamicPropertiesKey(l)));for(u=[],t=s.getResponse().getChannels(),i=0,a=t.length;a>i;i++)l=t[i],fm.stringExtensions.startsWith(l,"/fm/subscribers/")||fm.arrayExtensions.add(u,l);return s.getMethodArgs().setChannels(fm.arrayExtensions.toArray(u)),s.getResponse().setChannels(fm.arrayExtensions.toArray(u))}},e.getDynamicPropertiesKey=function(){var e;return e=arguments[0],fm.stringExtensions.concat("fm.subscribers.dynamicProperties",e)},e.getOnClientSubscribe=function(){var e;return e=arguments[0],e.getDynamicValue(fm.websync.subscribers.subscribeArgsExtensions._onClientSubscribePropertyName)},e.getOnClientSubscribeKey=function(){var e;return e=arguments[0],fm.stringExtensions.concat("fm.subscribers.onClientSubscribe",e)},e.getOnClientUnsubscribe=function(){var e;return e=arguments[0],e.getDynamicValue(fm.websync.subscribers.subscribeArgsExtensions._onClientUnsubscribePropertyName)},e.getOnClientUnsubscribeKey=function(){var e;return e=arguments[0],fm.stringExtensions.concat("fm.subscribers.onClientUnsubscribe",e)},e.setOnClientSubscribe=function(){var e,t;return e=arguments[0],t=arguments[1],e.setDynamicValue(fm.websync.subscribers.subscribeArgsExtensions._onClientSubscribePropertyName,t),e},e.setOnClientUnsubscribe=function(){var e,t;return e=arguments[0],t=arguments[1],e.setDynamicValue(fm.websync.subscribers.subscribeArgsExtensions._onClientUnsubscribePropertyName,t),e},fm.websync.subscribeArgs.prototype.getOnClientSubscribe=function(){return Array.prototype.splice.call(arguments,0,0,this),fm.websync.subscribers.subscribeArgsExtensions.getOnClientSubscribe.apply(this,arguments)},fm.websync.subscribeArgs.prototype.getOnClientUnsubscribe=function(){return Array.prototype.splice.call(arguments,0,0,this),fm.websync.subscribers.subscribeArgsExtensions.getOnClientUnsubscribe.apply(this,arguments)},fm.websync.subscribeArgs.prototype.setOnClientSubscribe=function(){var e;return e=arguments[0],Array.prototype.splice.call(arguments,0,0,this),fm.websync.subscribers.subscribeArgsExtensions.setOnClientSubscribe.apply(this,arguments)},fm.websync.subscribeArgs.prototype.setOnClientUnsubscribe=function(){var e;return e=arguments[0],Array.prototype.splice.call(arguments,0,0,this),fm.websync.subscribers.subscribeArgsExtensions.setOnClientUnsubscribe.apply(this,arguments)},e._onClientSubscribePropertyName="fm.subscribers.onClientSubscribe",e._onClientUnsubscribePropertyName="fm.subscribers.onClientUnsubscribe",fm.websync.client.addOnSubscribeRequest(e.client_OnSubscribeRequest),fm.websync.client.addOnSubscribeResponse(e.client_OnSubscribeResponse),fm.websync.client.addOnSubscribeEnd(e.client_OnSubscribeEnd),fm.websync.client.addOnUnsubscribeRequest(e.client_OnUnsubscribeRequest),fm.websync.client.addOnUnsubscribeResponse(e.client_OnUnsubscribeResponse),e}();var n=function(e,t){return function(){return e.apply(t,arguments)}},e=function(e,n){function s(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return s.prototype=n.prototype,e.prototype=new s,e.__super__=n.prototype,e},t={}.hasOwnProperty;fm.websync.subscribers.subscriberChange=function(t){function s(){this.toJson=n(this.toJson,this),this.setType=n(this.setType,this),this.setClient=n(this.setClient,this),this.getType=n(this.getType,this),this.getClient=n(this.getClient,this);var e;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(e=s.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),e):e=s.__super__.constructor.call(this)}return e(s,t),s.prototype.__client=null,s.prototype.__type=null,s.fromJson=function(){var e;return e=arguments[0],fm.websync.subscribers.serializer.deserializeSubscriberChange(e)},s.toJson=function(){var e;return e=arguments[0],fm.websync.subscribers.serializer.serializeSubscriberChange(e)},s.prototype.getClient=function(){return this.__client},s.prototype.getType=function(){return this.__type},s.prototype.setClient=function(){var e;return e=arguments[0],this.setIsDirty(!0),this.__client=e},s.prototype.setType=function(){var e;return e=arguments[0],this.setIsDirty(!0),this.__type=e},s.prototype.toJson=function(){return fm.websync.subscribers.subscriberChange.toJson(this)},s}(fm.serializable);var n=function(e,t){return function(){return e.apply(t,arguments)}},e=function(e,n){function s(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return s.prototype=n.prototype,e.prototype=new s,e.__super__=n.prototype,e},t={}.hasOwnProperty;return fm.websync.subscribers.clientSubscribeArgs=function(t){function s(){this.getSubscribedClient=n(this.getSubscribedClient,this),this.getChannel=n(this.getChannel,this);var e,t,r;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(t=s.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),t):(e=arguments[0],r=arguments[1],t=s.__super__.constructor.call(this),this.__channel=e,this.__subscribedClient=r,t)}return e(s,t),s.prototype.__channel=null,s.prototype.__subscribedClient=null,s.prototype.getChannel=function(){return this.__channel},s.prototype.getSubscribedClient=function(){return this.__subscribedClient},s}(fm.websync.baseSuccessArgs),fm.websync.subscribers.subscribeSuccessArgsExtensions=function(){function e(){var t;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(t=e.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),t):void 0}return e.getSubscribedClients=function(){var e;return e=arguments[0],fm.websync.subscribers.base.getSubscribedClients(e)},fm.websync.subscribeSuccessArgs.prototype.getSubscribedClients=function(){return Array.prototype.splice.call(arguments,0,0,this),fm.websync.subscribers.subscribeSuccessArgsExtensions.getSubscribedClients.apply(this,arguments)},e}(),fm.websync.subscribers});